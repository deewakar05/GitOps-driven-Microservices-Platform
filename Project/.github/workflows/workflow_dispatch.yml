name: Manual Workflow Trigger

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        default: 'staging'
        type: choice
        options:
          - staging
          - production
      run_tests:
        description: 'Run tests'
        required: true
        default: true
        type: boolean
      build_image:
        description: 'Build Docker image'
        required: true
        default: true
        type: boolean

jobs:
  manual-deploy:
    name: Manual Deployment
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Display inputs
      run: |
        echo "Environment: ${{ github.event.inputs.environment }}"
        echo "Run tests: ${{ github.event.inputs.run_tests }}"
        echo "Build image: ${{ github.event.inputs.build_image }}"
    
    - name: Run tests
      if: github.event.inputs.run_tests == 'true'
      working-directory: ./microservice
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        python test_app.py
    
    - name: Build Docker image
      if: github.event.inputs.build_image == 'true'
      working-directory: ./microservice
      run: |
        docker build -t user-microservice:${{ github.event.inputs.environment }} .
        echo "Docker image built: user-microservice:${{ github.event.inputs.environment }}"

